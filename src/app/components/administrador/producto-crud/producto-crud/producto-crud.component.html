<!-- src/app/components/administrador/producto-crud/producto-crud.component.html -->
<div class="crud-container">
  <aside class="sidebar">
    <div class="logo">
      <img src="assets/icon/logo.jpg" alt="Logo" />
    </div>
    <nav>
      <ul>
        <li><a (click)="irAPagina('inicio')">üè† Inicio</a></li>
        <li><a (click)="irAPagina('locales')">üìç Locales</a></li>
        <li><a (click)="irAPagina('socios')">üßë‚Äçü§ù‚Äçüßë Socios</a></li>
        <li><a (click)="irAPagina('oferta')">üè∑ Ofertas</a></li>
        <li><a (click)="irAPagina('plano_contenedores')">üöõ Contenedores</a></li>
        <li><a (click)="irAPagina('producto')" class="active">üì¶ Productos</a></li>
      </ul>
    </nav>
    <nav class="bottom-nav">
      <ul>
        <li><a href="#Usuario">üë§ Usuario</a></li>
        <li><a href="#config">‚öôÔ∏è Configuraci√≥n</a></li>
      </ul>
    </nav>
  </aside>

  <main class="content-area">
    <!-- Formulario para CREAR Nuevo Producto -->
    <div class="form-card">
      <h2>Crear Nuevo Producto</h2>
      <div class="form-grid">
        <div class="form-group">
          <label for="nombre">Nombre del Producto:</label>
          <input id="nombre" type="text" [(ngModel)]="nombre" required />
        </div>

        <div class="form-group full-width">
          <label for="descripcion_adicional">Descripci√≥n Adicional:</label>
          <textarea id="descripcion_adicional" [(ngModel)]="descripcion_adicional"></textarea>
        </div>

        <div class="form-group">
          <label for="categoria">Categor√≠a:</label>
          <select id="categoria" [(ngModel)]="id_categoria" required>
            <option [ngValue]="null">Seleccionar Categor√≠a</option>
            <option *ngFor="let categoria of categorias" [ngValue]="categoria.id_categoria">{{ categoria.nombre_categoria }}</option>
          </select>
        </div>

        <div class="form-group">
          <label>Locales Asignados:</label>
          <div class="selected-locales-display">
            <span *ngIf="localesSeleccionados.length === 0" class="placeholder-text">Ning√∫n local seleccionado.</span>
            <div *ngIf="localesSeleccionados.length > 0" class="locales-chips-container">
              <span class="local-chip" *ngFor="let localId of localesSeleccionados">
                {{ getNombreLocalParaChip(localId) }}
              </span>
            </div>
            <button type="button" (click)="openSelectLocalesDialog()" class="select-locales-button">
              Seleccionar/Editar Locales
            </button>
          </div>
        </div>
      </div>

      <div class="form-actions">
        <button (click)="crearProducto()">Guardar Producto</button>
        <button (click)="resetForm()" class="cancel-button">Limpiar Formulario</button>
      </div>
    </div>

    <!-- Secci√≥n de B√∫squeda y Lista de Productos -->
    <div class="table-card">
      <h2>Lista de Productos</h2>
      <div class="search-bar">
        <input type="text" [(ngModel)]="searchTerm" (input)="applyProductFilter()" placeholder="Buscar producto por nombre..." class="search-input">
        <button (click)="applyProductFilter()" class="search-button">Buscar</button>
      </div>

      <table>
        <thead>
          <tr>
            <th>Nombre</th>
            <th>Categor√≠a</th>
            <th>Locales</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let producto of filteredProductos">
            <td>{{ producto.nombre }}</td>
            <td>{{ getCategoriaNombre(producto.id_categoria) }}</td>
            <td>{{ getLocalesNombresParaTabla(producto.locales) }}</td>
            <td class="action-buttons">
              <!-- CAMBIO: Llama al nuevo m√©todo para abrir el modal de edici√≥n -->
              <button (click)="openEditProductoDialog(producto)" class="edit-button">Editar</button>
              <button (click)="eliminarProducto(producto)" class="delete-button">Eliminar</button>
            </td>
          </tr>
          <tr *ngIf="filteredProductos.length === 0">
            <td colspan="4" class="no-results-message">No se encontraron productos que coincidan con la b√∫squeda.</td>
          </tr>
        </tbody>
      </table>
    </div>
  </main>
</div>
